<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- 제이쿼리 -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <title>Document</title>
</head>
<body>
  <!-- <img id="test" src="https://codingapple1.github.io/kona.jpg">  -->
  <button id="btn">성공</button>
  <script>
    //promise는 ajax나 setTimeout같은 비동기코드를 콜백함수로 작성하고 싶지 않을때 사용한다

    // ** promise 기본 개념 **
    // promise : 성공 실패 판정하는 기계
    // var promise = new Promise(function(resolve, reject){//파라미터를 무조건 두개 써줘야함 (성공, 실패)
    //   var 어려운연산 = 1 + 1;
    //   resolve(어려운연산); // -> '성공' 파라미터로 결과 값을 받아서 then함수로 보내줌
    //   // reject(); // -> '실패'
    // }); 
    // //위에서 성공 & 실패를 판정 후 밑에 코드 실행한다

    // promise.then(function(결과){// -> 이렇게 파라미터로 결과 값을 받을 수 있다
    //   console.log('성공 ' + 결과); // -> 성공 2 출력
    // }).catch(function(){
    //   console.log('실패');
    // }).finally(function(){
    //   console.log('끝');
    // })
    //promise 장점 : 이렇게 쓸 수 있어서 코드가 옆으로 길어지지 않음
    //then : 프로미스가 성공일 경우 실행되는 코드
    //catch : 프로미스가 실패 할 경우 실행되는 코드
    //finally : 성공했든 실패했든 실행되는 코드

    //promise 예시
    // var promise = new Promise(function(resolve, reject){
    //   setTimeout(function(){
    //     resolve();
    //   }, 1000);
    // });
    // promise.then(function(){
    //   console.log('성공');
    // }).catch(function(){
    //   console.log('실패');
    // }).finally(function(){
    //   console.log('끝');
    // })

    //promise 특징
    //promise의 3가지 상태
    //1. 성공일 경우 <resolved>
    //2. 판정 대기중 <pending>
    //3. 실패일 경우 <rejected>

    //연습문제
    // var promise = new Promise(function(resolve, reject){
    //   var img = document.getElementById('test');
    //   img.addEventListener('load', function(){
    //     resolve();
    //   });
    //   img.addEventListener('error', function(){
    //     reject();
    //   });
    // });
    // promise.then(function(){
    //   console.log('성공');
    // }).catch(function(){
    //   console.log('실패');
    // });

    // function ajax해주는함수(url){
    //   return new Promise(function(resolve, reject){
    //     $.ajax({
    //       type : 'GET',
    //       url : url
    //     }).done(function(결과){
    //       resolve(결과);
    //     });
    //   })
    // };

    // var ajax = ajax해주는함수('https://codingapple1.github.io/hello.txt');

    // ajax.then(function(결과){
    //   console.log(결과);
    //   return ajax해주는함수('https://codingapple1.github.io/hello2.txt');
    // }).then(function(결과){
    //   console.log(결과);
    // });

    //promise의 대체 문법 async/await

    //async : promise의 기능을 해준다 함수앞에만 사용가능
    //근데 이건 성공만 가능하다
    // async function 계산(){
      // return 1 + 1;
      // return Promise.reject('실패'); //--> 이렇게 억지로 실패를 할수있음

      //async 안에서 await사용하기
      //async안에서 promise를 만들 수 있다
    //   var promise = new Promise(function(resolve, reject){
    //     var 연산 = 1 + 1;
    //     // resolve(연산);
    //     reject(연산);
    //     //await에서 실패했을땐 그냥 에러창이 나온다 에러를 방지하기 위해서는 try{} catch{}를 사용할수있다
    //   });

    //   try {//try안의 코드가 실패하면 catch코드가 실행됨
    //     var 결과 = await promise;
    //     //await : promise의 결과가 나오기까지 기다리다가 결과가 나오면 진행 then문법과 같다
    //     console.log(결과);//여기서 파라미터는 resolve의 값을 받아오는 역할이다
    //   } catch {
    //     console.log('실패'); //-> 실패 출력
    //   }
    // }

    // 계산(); //-> 2 출력

    // 계산().then(function(결과){
    //   console.log('성공' + 결과);
    // });

    //**연습문제**
    //button을 누르면 성공판정하는 promise
    async function click(){
      var 버튼클릭 = new Promise(function(resolve, reject){
        var btn = document.querySelector('#btn');
        btn.addEventListener('click', function(){
          resolve('성공했어요');
        });
      });
      var 결과 = await 버튼클릭;
      console.log(결과);
    };
    click();


  </script>
</body>
</html>